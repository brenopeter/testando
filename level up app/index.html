<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Level Up OS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #121212; color: #E0E0E0; }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .card { background-color: #1E1E1E; border: 1px solid #333; }
        .btn { padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: bold; transition: all 0.2s; }
        .btn-primary { background-color: #8B5CF6; color: white; }
        .btn-primary:hover { background-color: #7C3AED; }
        .btn-danger { background-color: #DC2626; color: white; }
        .btn-danger:hover { background-color: #B91C1C; }
        .btn-secondary { background-color: #374151; color: white; }
        .btn-secondary:hover { background-color: #4B5563; }
        .form-input { background-color: #374151; border: 1px solid #4B5563; border-radius: 0.5rem; padding: 0.5rem; width: 100%; }
        /* Componentes de UI */
        #toast-container { position: fixed; top: 1rem; right: 1rem; z-index: 9999; }
        .toast { background-color: #1E1E1E; color: white; padding: 1rem; border-radius: 0.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.5); margin-bottom: 0.5rem; border-left-width: 4px; }
        .toast-success { border-color: #22C55E; }
        .toast-error { border-color: #EF4444; }
        #modal-overlay { position: fixed; inset: 0; background-color: rgba(0,0,0,0.7); z-index: 5000; display: flex; align-items: center; justify-content: center; }
        #app-container { transition: opacity 0.5s; }
        .editable-name:hover { background-color: #374151; cursor: pointer; }
    </style>
</head>
<body class="bg-[#121212]">

    <div id="app-container" class="max-w-md mx-auto h-screen flex flex-col">
        <main class="flex-grow overflow-y-auto p-4 pb-20 space-y-6">
            </main>
        <nav id="main-nav" class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-[#1E1E1E] border-t border-gray-700 flex justify-around p-2"></nav>
    </div>

    <div id="toast-container"></div>
    <div id="modal-overlay" class="hidden"></div>

    <script id="main-script">
        // --- MÓDULOS DO APLICATIVO ---

        const Player = {
            state: null,
            ATTRIBUTES_LIST: ['Força', 'Inteligência', 'Disciplina', 'Carisma', 'Criatividade'],
            defaultState: {
                name: "Despertado", level: 1, exp: 0, title: "Novato",
                attributes: { 'Força': 0, 'Inteligência': 0, 'Disciplina': 0, 'Carisma': 0, 'Criatividade': 0 },
                missions: { daily: [], main: [], side: [] },
                history: [{ timestamp: Date.now(), text: "Jornada iniciada." }],
                lastLogin: new Date().toLocaleDateString('pt-BR')
            },
            load() {
                const savedData = localStorage.getItem('levelUpOsData');
                this.state = savedData ? JSON.parse(savedData) : { ...this.defaultState };
                this.checkDailyReset();
            },
            save() {
                localStorage.setItem('levelUpOsData', JSON.stringify(this.state));
            },
            addHistory(text) {
                this.state.history.unshift({ timestamp: Date.now(), text });
                if (this.state.history.length > 50) this.state.history.pop();
            },
            checkDailyReset() {
                const today = new Date().toLocaleDateString('pt-BR');
                if (this.state.lastLogin !== today) {
                    this.state.missions.daily.forEach(m => m.done = false);
                    this.state.lastLogin = today;
                    this.addHistory("Missões diárias resetadas.");
                    this.save();
                }
            },
            updateTitle() {
                const { level, attributes } = this.state;
                let newTitle = "Novato";
                if (level >= 5) newTitle = "Aprendiz";
                if (level >= 10) newTitle = "Veterano";
                const highAttr = Object.keys(attributes).reduce((a, b) => attributes[a] > attributes[b] ? a : b);
                if (attributes[highAttr] >= 20) newTitle = `${highAttr} Promissor`;
                if (attributes[highAttr] >= 50) newTitle = `Mestre em ${highAttr}`;
                if (this.state.title !== newTitle) {
                    this.addHistory(`Novo título adquirido: ${newTitle}`);
                    this.state.title = newTitle;
                }
            },
            toggleMission(type, id) {
                const mission = this.state.missions[type].find(m => m.id === id);
                if (!mission) return;
                mission.done = !mission.done;
                const category = mission.category;

                if (mission.done) {
                    this.state.exp += mission.exp;
                    if (category && this.state.attributes.hasOwnProperty(category)) {
                        this.state.attributes[category]++;
                    }
                    this.addHistory(`Missão concluída: ${mission.title} (+${mission.exp} EXP, +1 ${category})`);
                } else {
                    this.state.exp -= mission.exp;
                    if (category && this.state.attributes.hasOwnProperty(category)) {
                        this.state.attributes[category]--;
                    }
                }
                this.checkLevelUp();
                this.updateTitle();
                this.save();
                UI.render();
            },
            checkLevelUp() {
                const expToNextLevel = this.state.level * 1000;
                if (this.state.exp >= expToNextLevel) {
                    this.state.level++;
                    this.state.exp -= expToNextLevel;
                    this.addHistory(`LEVEL UP! Você alcançou o Nível ${this.state.level}!`);
                    this.checkLevelUp();
                }
            },
            addMission(data) {
                const mission = { id: Date.now(), done: false, ...data };
                this.state.missions[data.type].push(mission);
                this.addHistory(`Missão "${data.type}" adicionada: ${data.title}`);
                this.save();
                UI.render();
            },
            updateMission(id, newData) {
                ['daily', 'main', 'side'].forEach(type => {
                    const mission = this.state.missions[type].find(m => m.id === id);
                    if (mission) Object.assign(mission, newData);
                });
                this.addHistory(`Missão atualizada: ${newData.title}`);
                this.save();
                UI.render();
            },
            deleteMission(type, id) {
                const missionIndex = this.state.missions[type].findIndex(m => m.id === id);
                if (missionIndex > -1) {
                    const deleted = this.state.missions[type].splice(missionIndex, 1);
                    this.addHistory(`Missão removida: ${deleted[0].title}`);
                    this.save();
                    UI.render();
                }
            }
        };

        const UI = {
            elements: {
                main: document.querySelector('main'),
                nav: document.getElementById('main-nav'),
                modalOverlay: document.getElementById('modal-overlay'),
                toastContainer: document.getElementById('toast-container')
            },
            render() {
                this.elements.main.innerHTML = this.getScreenHTML(App.currentScreen);
                this.setupScreenEventListeners(App.currentScreen);
                this.updateNav();
            },
            updateNav() {
                this.elements.nav.innerHTML = `
                    <button data-screen="dashboard" class="flex-1 flex flex-col items-center p-2"><i class="fas fa-user-circle text-2xl"></i><span class="text-xs">Painel</span></button>
                    <button data-screen="missions" class="flex-1 flex flex-col items-center p-2"><i class="fas fa-tasks text-2xl"></i><span class="text-xs">Missões</span></button>
                    <button data-screen="evolution" class="flex-1 flex flex-col items-center p-2"><i class="fas fa-chart-line text-2xl"></i><span class="text-xs">Evolução</span></button>
                    <button data-screen="system" class="flex-1 flex flex-col items-center p-2"><i class="fas fa-cog text-2xl"></i><span class="text-xs">Sistema</span></button>
                `;
                this.elements.nav.querySelectorAll('button').forEach(btn => {
                    btn.classList.toggle('text-purple-400', btn.dataset.screen === App.currentScreen);
                    btn.addEventListener('click', () => App.switchScreen(btn.dataset.screen));
                });
            },
            getScreenHTML(screen) {
                switch(screen) {
                    case 'dashboard': return this.getDashboardHTML();
                    case 'missions': return this.getMissionsHTML();
                    case 'evolution': return this.getEvolutionHTML();
                    case 'system': return this.getSystemHTML();
                    default: return '';
                }
            },
            getDashboardHTML() {
                const { name, title, level, exp } = Player.state;
                const expToNextLevel = level * 1000;
                const expPercentage = (exp / expToNextLevel) * 100;
                const dailyMissionsHTML = this.getMissionsListHTML('daily');
                return `
                    <div class="text-center">
                        <h1 id="player-name" class="text-3xl font-bold font-orbitron p-2 rounded editable-name">${name}</h1>
                        <p class="text-purple-400 text-lg">${title}</p>
                    </div>
                    <div class="card p-4 rounded-lg">
                        <div class="flex justify-between items-center mb-2"><span class="font-bold font-orbitron">NÍVEL ${level}</span><span class="text-sm">${exp} / ${expToNextLevel} EXP</span></div>
                        <div class="w-full bg-gray-700 rounded-full h-4"><div class="bg-purple-500 h-4 rounded-full" style="width: ${expPercentage}%"></div></div>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold mb-3 font-orbitron">MISSÕES DIÁRIAS</h2><div class="space-y-2">${dailyMissionsHTML}</div>
                    </div>`;
            },
            getMissionsHTML() {
                const mainMissionsHTML = this.getMissionsListHTML('main');
                const sideMissionsHTML = this.getMissionsListHTML('side');
                return `
                    <h1 class="text-2xl font-bold font-orbitron">CENTRAL DE MISSÕES</h1>
                    <button id="add-mission-btn" class="btn btn-primary w-full"><i class="fas fa-plus mr-2"></i>Adicionar Nova Missão</button>
                    <div><h2 class="text-xl font-bold mb-3 font-orbitron">PRINCIPAIS</h2><div class="space-y-2">${mainMissionsHTML}</div></div>
                    <div><h2 class="text-xl font-bold mb-3 font-orbitron">SECUNDÁRIAS</h2><div class="space-y-2">${sideMissionsHTML}</div></div>`;
            },
            getMissionsListHTML(type) {
                const missions = Player.state.missions[type] || [];
                if (missions.length === 0) return `<p class="text-gray-500 text-sm p-2">Nenhuma missão aqui.</p>`;
                return missions.map(mission => `
                    <div class="card p-3 rounded-lg flex items-center justify-between">
                        <div class="flex items-center flex-grow min-w-0 mr-2">
                            <input type="checkbox" data-id="${mission.id}" data-type="${type}" ${mission.done ? 'checked' : ''} class="h-5 w-5 rounded text-purple-500 bg-gray-700 border-gray-600 focus:ring-purple-500 flex-shrink-0">
                            <label class="ml-3 truncate ${mission.done ? 'line-through text-gray-500' : ''}">${mission.title}</label>
                        </div>
                        <div class="flex items-center gap-2 flex-shrink-0">
                           <span class="text-sm font-bold text-yellow-400">+${mission.exp} EXP</span>
                           <button class="edit-mission-btn" data-id="${mission.id}" data-type="${type}"><i class="fas fa-pencil text-gray-400 hover:text-white"></i></button>
                           <button class="delete-mission-btn" data-id="${mission.id}" data-type="${type}"><i class="fas fa-trash text-gray-400 hover:text-red-500"></i></button>
                        </div>
                    </div>`).join('');
            },
            getEvolutionHTML() {
                const { attributes } = Player.state;
                const attributeIcons = { 'Força': 'fa-dumbbell', 'Inteligência': 'fa-brain', 'Disciplina': 'fa-calendar-check', 'Carisma': 'fa-comments', 'Criatividade': 'fa-lightbulb' };
                let html = `<h1 class="text-2xl font-bold font-orbitron">PAINEL DE EVOLUÇÃO</h1>`;
                for (const attr in attributes) {
                    const points = attributes[attr]; const level = Math.floor(points / 10) + 1; const progress = (points % 10) * 10;
                    html += `
                        <div class="card p-4 rounded-lg">
                            <div class="flex justify-between items-center mb-2"><h3 class="text-lg font-bold flex items-center"><i class="fas ${attributeIcons[attr]} w-6 text-center mr-2 text-purple-400"></i>${attr}</h3><span class="font-orbitron font-bold">NÍVEL ${level}</span></div>
                            <div class="w-full bg-gray-700 rounded-full h-4"><div class="bg-purple-500 h-4 rounded-full" style="width: ${progress}%"></div></div>
                            <p class="text-right text-xs text-gray-400 mt-1">${points} Pontos Totais</p>
                        </div>`;
                }
                return html;
            },
            getSystemHTML() {
                const historyHTML = Player.state.history.map(item => `<p class="text-sm"><span class="text-gray-500">${new Date(item.timestamp).toLocaleTimeString('pt-BR')}</span> <span class="text-gray-300">${item.text}</span></p>`).join('');
                return `
                    <h1 class="text-2xl font-bold font-orbitron">SISTEMA</h1>
                    <div class="card p-4 rounded-lg">
                        <h2 class="text-lg font-bold mb-2">Log de Atividades</h2><div class="h-64 overflow-y-auto space-y-2 p-2 bg-black/20 rounded">${historyHTML}</div>
                    </div>
                    <div class="card p-4 rounded-lg">
                        <h2 class="text-lg font-bold mb-2">Gerenciamento de Dados</h2>
                        <button id="reset-btn" class="btn btn-danger w-full">Resetar Progresso</button>
                    </div>`;
            },
            setupScreenEventListeners(screen) {
                const setupMissionListeners = () => {
                    document.querySelectorAll('input[type="checkbox"]').forEach(el => el.addEventListener('change', () => Player.toggleMission(el.dataset.type, parseInt(el.dataset.id))));
                    document.querySelectorAll('.edit-mission-btn').forEach(el => el.addEventListener('click', () => {
                        const mission = Player.state.missions[el.dataset.type].find(m => m.id === parseInt(el.dataset.id));
                        if (mission) this.showMissionModal(mission, el.dataset.type);
                    }));
                    document.querySelectorAll('.delete-mission-btn').forEach(el => el.addEventListener('click', () => {
                        if (confirm("Tem certeza que quer apagar esta missão?")) Player.deleteMission(el.dataset.type, parseInt(el.dataset.id));
                    }));
                };
                switch(screen) {
                    case 'dashboard':
                        setupMissionListeners();
                        document.getElementById('player-name').addEventListener('click', () => {
                            const newName = prompt("Digite seu novo nome:", Player.state.name);
                            if (newName && newName.trim() !== '') {
                                Player.state.name = newName.trim();
                                Player.save();
                                this.render();
                            }
                        });
                        break;
                    case 'missions':
                        setupMissionListeners();
                        document.getElementById('add-mission-btn').addEventListener('click', () => this.showMissionModal());
                        break;
                    case 'system':
                        document.getElementById('reset-btn').addEventListener('click', () => {
                            if (confirm("CUIDADO! Isso apagará TODO o seu progresso neste dispositivo. Ação irreversível. Deseja continuar?")) {
                                localStorage.removeItem('levelUpOsData');
                                Player.load();
                                this.render();
                            }
                        });
                        break;
                }
            },
            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                toast.textContent = message;
                this.elements.toastContainer.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            },
            showMissionModal(mission = null, type = 'main') {
                const isEditing = mission !== null;
                const categoriesHTML = Player.ATTRIBUTES_LIST.map(cat => `<option value="${cat}" ${mission?.category === cat ? 'selected' : ''}>${cat}</option>`).join('');
                
                this.elements.modalOverlay.innerHTML = `
                    <div class="card p-6 rounded-lg w-11/12 space-y-4" onclick="event.stopPropagation()">
                        <h2 class="text-xl font-bold font-orbitron">${isEditing ? 'Editar Missão' : 'Nova Missão'}</h2>
                        <form id="mission-form" class="space-y-4">
                            <input type="text" name="title" placeholder="Título da Missão" class="form-input" value="${mission?.title || ''}" required>
                            <input type="number" name="exp" placeholder="EXP" class="form-input" value="${mission?.exp || ''}" required>
                            <select name="category" class="form-input">${categoriesHTML}</select>
                            <select name="type" class="form-input">
                                <option value="main" ${type === 'main' ? 'selected' : ''}>Principal</option>
                                <option value="side" ${type === 'side' ? 'selected' : ''}>Secundária</option>
                                <option value="daily" ${type === 'daily' ? 'selected' : ''}>Diária</option>
                            </select>
                            <div class="flex justify-end gap-2">
                                <button type="button" id="modal-cancel-btn" class="btn btn-secondary">Cancelar</button>
                                <button type="submit" class="btn btn-primary">${isEditing ? 'Salvar' : 'Criar'}</button>
                            </div>
                        </form>
                    </div>`;
                this.elements.modalOverlay.classList.remove('hidden');
                
                document.getElementById('modal-cancel-btn').addEventListener('click', () => this.elements.modalOverlay.classList.add('hidden'));
                this.elements.modalOverlay.addEventListener('click', () => this.elements.modalOverlay.classList.add('hidden'));
                
                document.getElementById('mission-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const data = Object.fromEntries(formData.entries());
                    data.exp = parseInt(data.exp);

                    if (isEditing) {
                        // Se o tipo mudou, precisa remover da lista antiga e adicionar na nova
                        if(type !== data.type) Player.deleteMission(type, mission.id);
                        Player.updateMission(mission.id, data);
                        this.showToast("Missão atualizada!");
                    } else {
                        Player.addMission(data);
                        this.showToast(`Missão criada na categoria: ${data.category}`);
                    }
                    this.elements.modalOverlay.classList.add('hidden');
                });
            }
        };

        const App = {
            currentScreen: 'dashboard',
            init() {
                Player.load();
                UI.render();
            },
            switchScreen(screen) {
                this.currentScreen = screen;
                UI.render();
            }
        };

        // --- INICIALIZAÇÃO ---
        App.init();

    </script>
</body>
</html>
